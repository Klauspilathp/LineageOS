<!doctype html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
	<meta charset="UTF-8">
	<title>d7c 系统管理平台</title>
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,user-scalable=yes,minimum-scale=0.4,initial-scale=0.8" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="stylesheet" href="/static/css/font.css">
	<link rel="stylesheet" href="/static/css/xadmin.css">
	<!-- <link rel="stylesheet" href="/static/css/theme5.css"> -->
</head>
<body class="index">
	<!-- 顶部开始 -->
	<div class="container">
		<div class="logo">
			<a href="./main">d7c 系统管理平台</a>
		</div>
		<div class="left_open">
			<a><i title="收放左侧栏" class="iconfont">&#xe699;</i></a>
		</div>
		<ul class="layui-nav left fast-add" lay-filter="">
			<li class="layui-nav-item"><a href="javascript:;">+新增</a>
				<dl class="layui-nav-child">
					<!-- 二级菜单 -->
					<dd>
						<a onclick="xadmin.open('最大化', 'http://www.baidu.com', '', '', true)"> <i class="iconfont">&#xe6a2;</i>弹出最大化</a>
					</dd>
					<dd>
						<a onclick="xadmin.open('弹出自动宽高', 'http://www.baidu.com')"> <i class="iconfont">&#xe6a8;</i>弹出自动宽高</a>
					</dd>
					<dd>
						<a onclick="xadmin.open('弹出指定宽高', 'http://www.baidu.com', 500, 300)"> <i class="iconfont">&#xe6a8;</i>弹出指定宽高</a>
					</dd>
					<dd>
						<a onclick="xadmin.add_tab('在tab打开', 'http://www.baidu.com')"> <i class="iconfont">&#xe6b8;</i>在tab打开</a>
					</dd>
					<dd>
						<a onclick="xadmin.add_tab('在tab打开刷新', 'http://www.baidu.com', true)"> <i class="iconfont">&#xe6b8;</i>在tab打开刷新</a>
					</dd>
				</dl>
			</li>
		</ul>
		<ul class="layui-nav right" lay-filter="">
			<li class="layui-nav-item"><a href="javascript:;"><span sec:authentication="name"></span></a>
				<dl class="layui-nav-child">
					<!-- 二级菜单 -->
					<dd>
						<a onclick="xadmin.open('个人信息', 'http://www.baidu.com')">个人信息</a>
					</dd>
					<dd>
						<a onclick="xadmin.open('切换帐号', 'http://www.baidu.com')">切换帐号</a>
					</dd>
					<dd>
						<a href="./logout">退出</a>
					</dd>
				</dl>
			</li>
			<li class="layui-nav-item to-index"><a href="/main">前台首页</a></li>
		</ul>
	</div>
	<!-- 顶部结束 -->
	<!-- 中部开始 -->
	<!-- 左侧菜单开始 -->
	<div class="left-nav">
		<div id="side-nav">
			<!-- <ul id="nav">
				<li><a href="javascript:;"><i class="iconfont left-nav-li" lay-tips="会员管理">&#xe6b8;</i><cite>会员管理</cite><i class="iconfont nav_right">&#xe697;</i></a>
					<ul class="sub-menu">
						<li><a onclick="xadmin.add_tab('统计页面','welcome1.html')"><i class="iconfont">&#xe6a7;</i><cite>统计页面</cite></a></li>
						<li><a onclick="xadmin.add_tab('会员列表(静态表格)','member-list.html')"><i class="iconfont">&#xe6a7;</i><cite>会员列表(静态表格)</cite></a></li>
						<li><a onclick="xadmin.add_tab('会员列表(动态表格)','member-list1.html',true)"><i class="iconfont">&#xe6a7;</i> <cite>会员列表(动态表格)</cite></a></li>
						<li><a onclick="xadmin.add_tab('会员删除','member-del.html')"><i class="iconfont">&#xe6a7;</i><cite>会员删除</cite></a></li>
						<li><a href="javascript:;"> <i class="iconfont">&#xe70b;</i><cite>会员管理</cite><i class="iconfont nav_right">&#xe697;</i></a>
							<ul class="sub-menu">
								<li><a onclick="xadmin.add_tab('会员删除','member-del.html')"><i class="iconfont">&#xe6a7;</i><cite>会员删除</cite></a></li>
								<li><a onclick="xadmin.add_tab('等级管理','member-list1.html')"><i class="iconfont">&#xe6a7;</i><cite>等级管理</cite></a></li>
							</ul>
						</li>
					</ul>
				</li>
				<li><a href="javascript:;"><i class="iconfont left-nav-li" lay-tips="订单管理">&#xe723;</i><cite>订单管理</cite><i class="iconfont nav_right">&#xe697;</i></a>
					<ul class="sub-menu">
						<li><a onclick="xadmin.add_tab('订单列表','order-list.html')"><i class="iconfont">&#xe6a7;</i><cite>订单列表</cite></a></li>
						<li><a onclick="xadmin.add_tab('订单列表1','order-list1.html')"><i class="iconfont">&#xe6a7;</i><cite>订单列表1</cite></a></li>
					</ul>
				</li>
			</ul> -->
		</div>
	</div>
	<!-- 左侧菜单结束 -->
	<!-- 右侧主体开始 -->
	<div class="page-content">
		<div class="layui-tab tab" lay-filter="xbs_tab" lay-allowclose="false">
			<ul class="layui-tab-title">
				<li class="home"><i class="layui-icon">&#xe68e;</i>我的桌面</li>
			</ul>
			<div class="layui-unselect layui-form-select layui-form-selected" id="tab_right">
				<dl>
					<dd data-type="this">关闭当前</dd>
					<dd data-type="other">关闭其它</dd>
					<dd data-type="all">关闭全部</dd>
				</dl>
			</div>
			<div class="layui-tab-content">
				<div class="layui-tab-item layui-show">
					<iframe src='/welcome' frameborder="0" scrolling="yes" class="x-iframe"></iframe>
				</div>
			</div>
			<div id="tab_show"></div>
		</div>
	</div>
	<div class="page-content-bg"></div>
	<script type="text/javascript" src="/static/lib/layui/layui.js" charset="UTF-8"></script>
	<script type="text/javascript" src="/static/js/xadmin.js"></script>
	<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
	<!--[if lt IE 9]>
		<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
		<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->
	<script>
		// 是否开启刷新记忆 tab 功能
	    // var is_remember = false;
	</script>
	<script type="text/javascript">
		layui.extend({
		    'request': '/static/lib/layui/lay/modules/request' // 扩展模块
        }).use(['layer', 'jquery', 'request', 'element'], function() {
            var layer = layui.layer, $ = layui.jquery, request = layui.request, element = layui.element;
            // 渲染菜单
            request.get({
                url: '/sys/menu/authMenu', 
                dataType: 'json',
                success: function(res) {
                    var html = menuTree("<ul id='nav'>", res.data);
                    $("#side-nav").append(html);
                    
                    // 打开页面初始
                    xadmin.init();
                    //关闭tab清除记忆
                    element.on('tabDelete(xbs_tab)', function(data) {
                        var id = $(this).parent().attr('lay-id');
                        xadmin.del_data(id);
                    });
                    
                    // 左侧菜单
                    $('.left-nav #nav').on('click', 'li', function(event) {
                        if ($(this).parent().attr('id') == 'nav') {
                            xadmin.set_cate_data({
                                key: 'f1',
                                value: $('.left-nav #nav li').index($(this))
                            });
                            xadmin.set_cate_data({
                                key: 'f2',
                                value: null
                            });
                            xadmin.set_cate_data({
                                key: 'f3',
                                value: null
                            });
                        }

                        if ($(this).parent().parent().parent().attr('id') == 'nav') {
                            xadmin.set_cate_data({
                                key: 'f2',
                                value: $('.left-nav #nav li').index($(this))
                            });
                            xadmin.set_cate_data({
                                key: 'f3',
                                value: null
                            });
                        }

                        if ($(this).parent().parent().parent().parent().parent().attr('id') == 'nav') {
                            xadmin.set_cate_data({
                                key: 'f3',
                                value: $('.left-nav #nav li').index($(this))
                            });
                        }

                        if ($('.left-nav').css('width') == '60px') {
                            $('.left-nav').animate({
                                width: '220px'
                            }, 100);
                            $('.page-content').animate({
                                left: '220px'
                            }, 100);
                            $('.left-nav i').css('font-size', '14px');
                            $('.left-nav cite,.left-nav .nav_right').show();
                        }

                        if ($(window).width() < 768) {
                            $('.page-content-bg').show();
                        }

                        $('.left-nav').find('a').removeClass('active');
                        $(this).children('a').addClass('active');
                        if ($(this).children('.sub-menu').length) {
                            if ($(this).hasClass('open')) {
                                $(this).removeClass('open');
                                $(this).find('.nav_right').html('&#xe697;');
                                $(this).children('.sub-menu').stop(true, true).slideUp();
                                $(this).siblings().children('.sub-menu').slideUp();
                            } else {
                                $(this).addClass('open');
                                $(this).children('a').find('.nav_right').html('&#xe6a6;');
                                $(this).children('.sub-menu').stop(true, true).slideDown();
                                $(this).siblings().children('.sub-menu').stop(true, true).slideUp();
                                $(this).siblings().find('.nav_right').html('&#xe697;');
                                $(this).siblings().removeClass('open');
                            }
                        }
                        event.stopPropagation();
                    });
                    
                    var left_tips_index = null;
                    $('.left-nav #nav').on('mouseenter', '.left-nav-li', function(event) {
                        if ($('.left-nav').css('width') != '220px') {
                            var tips = $(this).attr('lay-tips');
                            left_tips_index = layer.tips(tips, $(this));
                        }
                    });

                    $('.left-nav #nav').on('mouseout', '.left-nav-li', function(event) {
                        layer.close(left_tips_index);
                    });
                    
                    // 隐藏左侧
                    $('.container .left_open i').click(function(event) {
                        if ($('.left-nav').css('width') == '220px') {
                            $('.left-nav .open').click();
                            $('.left-nav i').css('font-size', '18px');
                            $('.left-nav').animate({
                                width: '60px'
                            }, 100);
                            $('.left-nav cite,.left-nav .nav_right').hide();
                            $('.page-content').animate({
                                left: '60px'
                            }, 100);
                            $('.page-content-bg').hide();
                        } else {
                            $('.left-nav').animate({
                                width: '220px'
                            }, 100);
                            $('.page-content').animate({
                                left: '220px'
                            }, 100);
                            $('.left-nav i').css('font-size', '14px');
                            $('.left-nav cite,.left-nav .nav_right').show();
                            if ($(window).width() < 768) {
                                $('.page-content-bg').show();
                            }
                        }
                    });

                    $('.page-content-bg').click(function(event) {
                        $('.left-nav .open').click();
                        $('.left-nav i').css('font-size', '18px');
                        $('.left-nav').animate({
                            width: '60px'
                        }, 100);
                        $('.left-nav cite,.left-nav .nav_right').hide();
                        $('.page-content').animate({
                            left: '60px'
                        }, 100);
                        $(this).hide();
                    });

                    $(".layui-tab-title").on('contextmenu', 'li', function(event) {
                        var tab_left = $(this).position().left;
                        var tab_width = $(this).width();
                        var left = $(this).position().top;
                        var this_index = $(this).attr('lay-id');
                        $('#tab_right').css({
                            'left': tab_left + tab_width / 2
                        }).show().attr('lay-id', this_index);
                        $('#tab_show').show();
                        return false;
                    });

                    $('#tab_right').on('click', 'dd', function(event) {
                        var data_type = $(this).attr('data-type');
                        var lay_id = $(this).parents('#tab_right').attr('lay-id');
                        if (data_type == 'this') {
                            $('.layui-tab-title li[lay-id=' + lay_id + ']').find('.layui-tab-close').click();
                        } else if (data_type == 'other') {
                            $('.layui-tab-title li').eq(0).find('.layui-tab-close').remove();
                            $('.layui-tab-title li[lay-id!=' + lay_id + ']').find('.layui-tab-close').click();
                        } else if (data_type == 'all') {
                            $('.layui-tab-title li[lay-id]').find('.layui-tab-close').click();
                        }
                        $('#tab_right').hide();
                        $('#tab_show').hide();
                    });
                    
                    $('.page-content,#tab_show,.container,.left-nav').click(function(event) {
                        $('#tab_right').hide();
                        $('#tab_show').hide();
                    });
                    
                    // 页面加载完要做的
                    xadmin.end();
                }
            });
         
            function menuTree(container, data) {
                var html = container;
                $.each(data, function(i, menu) {
                    if (menu.visible != 1) {
                        return true;
                    }
                    if (menu.menuFunc == 1) { // 模块
                        html += "<li><a href='javascript:;'><i class='iconfont left-nav-li' lay-tips='";
                        html += menu.menuName + "'>&#xe6b8;</i><cite>" + menu.menuName + "</cite><i class='iconfont nav_right'>&#xe697;</i></a>";
                    } else if (menu.menuFunc == 2) { // 页面
                        html += "<li><a onclick=\"xadmin.add_tab('" + menu.menuName + "', '" + menu.menuUrl.replace(".shtml", "");
                        html += "')\"><i class='iconfont'>&#xe6a7;</i><cite>" + menu.menuName + "</cite></a>";
                    }
                    if (menu.childrens) {
                        html += menuTree("<ul class='sub-menu'>", menu.childrens);
                    }
                    html += "</li>";
                });
                html += "</ul>";
                return html;
            }
		});
    </script>
</body>
</html>